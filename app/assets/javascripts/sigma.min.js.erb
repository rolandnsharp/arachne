/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(k,s){var f=this.length;if("function"!=typeof k)throw new TypeError;for(var l=0;l<f;l++)if(l in this&&k.call(s,this[l],l,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(k,s){var f=this.length;if("function"!=typeof k)throw new TypeError;for(var l=0;l<f;l++)l in this&&k.call(s,this[l],l,this)});Array.prototype.map||(Array.prototype.map=function(k,s){var f=this.length;if("function"!=typeof k)throw new TypeError;
for(var l=Array(f),m=0;m<f;m++)m in this&&(l[m]=k.call(s,this[m],m,this));return l});Array.prototype.filter||(Array.prototype.filter=function(k,s){var f=this.length;if("function"!=typeof k)throw new TypeError;for(var l=[],m=0;m<f;m++)if(m in this){var y=this[m];k.call(s,y,m,this)&&l.push(y)}return l});Object.keys||(Object.keys=function(){var k=Object.prototype.hasOwnProperty,s=!{toString:null}.propertyIsEnumerable("toString"),f="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
l=f.length;return function(m){if("object"!==typeof m&&"function"!==typeof m||null===m)throw new TypeError("Object.keys called on non-object");var y=[],v;for(v in m)k.call(m,v)&&y.push(v);if(s)for(v=0;v<l;v++)k.call(m,f[v])&&y.push(f[v]);return y}}())})();sigma.classes.Cascade=function(){this.p={};this.config=function(k,s){if("string"==typeof k&&void 0==s)return this.p[k];var f="object"==typeof k&&void 0==s?k:{};"string"==typeof k&&(f[k]=s);for(var l in f)void 0!=this.p[l]&&(this.p[l]=f[l]);return this}};
sigma.classes.EventDispatcher=function(){var k={},s=this;this.one=function(f,l){if(!l||!f)return s;("string"==typeof f?f.split(" "):f).forEach(function(f){k[f]||(k[f]=[]);k[f].push({h:l,one:!0})});return s};this.bind=function(f,l){if(!l||!f)return s;("string"==typeof f?f.split(" "):f).forEach(function(f){k[f]||(k[f]=[]);k[f].push({h:l,one:!1})});return s};this.unbind=function(f,l){f||(k={});var m="string"==typeof f?f.split(" "):f;l?m.forEach(function(f){k[f]&&(k[f]=k[f].filter(function(f){return f.h!=
l}));k[f]&&0==k[f].length&&delete k[f]}):m.forEach(function(f){delete k[f]});return s};this.dispatch=function(f,l){k[f]&&(k[f].forEach(function(k){k.h({type:f,content:l,target:s})}),k[f]=k[f].filter(function(f){return!f.one}));return s}};
(function(){function k(){function b(a){return{x:a.x,y:a.y,size:a.size,degree:a.degree,inDegree:a.inDegree,outDegree:a.outDegree,displayX:a.displayX,displayY:a.displayY,displaySize:a.displaySize,label:a.label,id:a.id,color:a.color,fixed:a.fixed,active:a.active,hidden:a.hidden,forceLabel:a.forceLabel,attr:a.attr}}function r(a){return{source:a.source.id,target:a.target.id,size:a.size,type:a.type,arrow:a.arrow,weight:a.weight,displaySize:a.displaySize,label:a.label,hidden:a.hidden,id:a.id,attr:a.attr,
color:a.color}}function g(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:0.5,edgesPowRatio:0,arrowRatio:3};this.borders={};g();this.addNode=function(a,b){if(c.nodesIndex[a])throw Error('Node "'+a+'" already exists.');b=b||{};var d={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,
forceLabel:!1,label:a.toString(),id:a.toString(),attr:{}},g;for(g in b)switch(g){case "id":break;case "x":case "y":case "size":d[g]=+b[g];break;case "fixed":case "active":case "hidden":case "forceLabel":d[g]=!!b[g];break;case "color":case "label":d[g]=b[g];break;default:d.attr[g]=b[g]}c.nodes.push(d);c.nodesIndex[a.toString()]=d;return c};this.addEdge=function(a,b,d,g){if(c.edgesIndex[a])throw Error('Edge "'+a+'" already exists.');if(!c.nodesIndex[b])throw Error("Edge's source \""+b+'" does not exist yet.');
if(!c.nodesIndex[d])throw Error("Edge's target \""+d+'" does not exist yet.');g=g||{};b={source:c.nodesIndex[b],target:c.nodesIndex[d],size:1,weight:1,displaySize:0.5,label:a.toString(),id:a.toString(),hidden:!1,attr:{}};b.source.degree++;b.source.outDegree++;b.target.degree++;b.target.inDegree++;for(var p in g)switch(p){case "id":case "source":case "target":break;case "hidden":b[p]=!!g[p];break;case "size":case "weight":b[p]=+g[p];break;case "color":case "arrow":case "type":b[p]=g[p].toString();
break;case "label":b[p]=g[p];break;default:b.attr[p]=g[p]}c.edges.push(b);c.edgesIndex[a.toString()]=b;return c};this.dropNode=function(a){var b={};((a instanceof Array?a:[a])||[]).forEach(function(a){c.nodesIndex[a]?b[a]=!0:sigma.log('Node "'+a+'" does not exist.')});var d=[];c.nodes.forEach(function(a,c){a.id in b&&(d.unshift(c),0==a.degree&&delete b[a.id])});d.forEach(function(a){c.nodes.splice(a,1)});c.edges=c.edges.filter(function(a){return a.source.id in b?(delete c.edgesIndex[a.id],a.target.degree--,
a.target.inDegree--,!1):a.target.id in b?(delete c.edgesIndex[a.id],a.source.degree--,a.source.outDegree--,!1):!0});return c};this.dropEdge=function(a){((a instanceof Array?a:[a])||[]).forEach(function(a){if(c.edgesIndex[a]){c.edgesIndex[a].source.degree--;c.edgesIndex[a].source.outDegree--;c.edgesIndex[a].target.degree--;c.edgesIndex[a].target.inDegree--;var d=null;c.edges.some(function(b,c){return b.id==a?(d=c,!0):!1});null!=d&&c.edges.splice(d,1);delete c.edgesIndex[a]}else sigma.log('Edge "'+
a+'" does not exist.')});return c};this.iterEdges=function(a,b){var d=b?b.map(function(a){return c.edgesIndex[a]}):c.edges,g=d.map(r);g.forEach(a);d.forEach(function(a,b){var d=g[b],n;for(n in d)switch(n){case "id":case "displaySize":break;case "weight":case "size":a[n]=+d[n];break;case "source":case "target":a[n]=c.nodesIndex[n]||a[n];break;case "hidden":a[n]=!!d[n];break;case "color":case "label":case "arrow":case "type":a[n]=(d[n]||"").toString();break;default:a.attr[n]=d[n]}});return c};this.iterNodes=
function(a,g){var d=g?g.map(function(a){return c.nodesIndex[a]}):c.nodes,r=d.map(b);r.forEach(a);d.forEach(function(a,d){var b=r[d],c;for(c in b)switch(c){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":a[c]=+b[c];break;case "fixed":case "active":case "hidden":case "forceLabel":a[c]=!!b[c];break;case "color":case "label":a[c]=(b[c]||"").toString();break;default:a.attr[c]=b[c]}});return c};this.getEdges=
function(a){var b=((a instanceof Array?a:[a])||[]).map(function(a){return r(c.edgesIndex[a])});return a instanceof Array?b:b[0]};this.getNodes=function(a){var g=((a instanceof Array?a:[a])||[]).map(function(a){return b(c.nodesIndex[a])});return a instanceof Array?g:g[0]};this.empty=g;this.rescale=function(a,b,d,g){var p=0,r=0;d&&c.nodes.forEach(function(a){r=Math.max(a.size,r)});g&&c.edges.forEach(function(a){p=Math.max(a.size,p)});var r=r||1,p=p||1,t,n,h,f;d&&c.nodes.forEach(function(a){n=Math.max(a.x,
n||a.x);t=Math.min(a.x,t||a.x);f=Math.max(a.y,f||a.y);h=Math.min(a.y,h||a.y)});var k="outside"==c.p.scalingMode?Math.max(a/Math.max(n-t,1),b/Math.max(f-h,1)):Math.min(a/Math.max(n-t,1),b/Math.max(f-h,1)),A=(c.p.maxNodeSize||r)/k;n+=A;t-=A;f+=A;h-=A;var k="outside"==c.p.scalingMode?Math.max(a/Math.max(n-t,1),b/Math.max(f-h,1)):Math.min(a/Math.max(n-t,1),b/Math.max(f-h,1)),w,z;!c.p.maxNodeSize&&!c.p.minNodeSize?(w=1,z=0):c.p.maxNodeSize==c.p.minNodeSize?(w=0,z=c.p.maxNodeSize):(w=(c.p.maxNodeSize-c.p.minNodeSize)/
r,z=c.p.minNodeSize);var F,D;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(F=1,D=0):(F=c.p.maxEdgeSize==c.p.minEdgeSize?0:(c.p.maxEdgeSize-c.p.minEdgeSize)/p,D=c.p.minEdgeSize);d&&c.nodes.forEach(function(c){c.displaySize=c.size*w+z;c.fixed||(c.displayX=(c.x-(n+t)/2)*k+a/2,c.displayY=(c.y-(f+h)/2)*k+b/2)});g&&c.edges.forEach(function(a){a.displaySize=a.size*F+D});return c};this.translate=function(a,b,d,g,r){var f=Math.pow(d,c.p.nodesPowRatio);g&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*d+
a,c.displayY=c.displayY*d+b);c.displaySize*=f});r&&c.edges.forEach(function(a){a.displaySize*=Math.pow(d,c.p.edgesPowRatio);a.arrowDisplaySize=a.displaySize*c.p.arrowRatio*f});return c};this.setBorders=function(){c.borders={};c.nodes.forEach(function(a){c.borders.minX=Math.min(void 0==c.borders.minX?a.displayX-a.displaySize:c.borders.minX,a.displayX-a.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?a.displayX+a.displaySize:c.borders.maxX,a.displayX+a.displaySize);c.borders.minY=Math.min(void 0==
c.borders.minY?a.displayY-a.displaySize:c.borders.minY,a.displayY-a.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?a.displayY-a.displaySize:c.borders.maxY,a.displayY-a.displaySize)})};this.checkHover=function(a,b){var d,g,r,f=[],t=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{d=Math.abs(c.displayX-a);g=Math.abs(c.displayY-b);r=c.displaySize;var h=c.hover,k=d<r&&g<r&&Math.sqrt(d*d+g*g)<r;h&&!k?(c.hover=!1,t.push(c.id)):k&&!h&&(c.hover=!0,f.push(c.id))}});f.length&&c.dispatch("overnodes",
f);t.length&&c.dispatch("outnodes",t);return c}}function s(b,r){function g(){var a;a="<p>GLOBAL :</p>";for(var b in c.p.globalProbes)a+="<p>"+b+" : "+c.p.globalProbes[b]()+"</p>";a+="<br><p>LOCAL :</p>";for(b in c.p.localProbes)a+="<p>"+b+" : "+c.p.localProbes[b]()+"</p>";c.p.dom.innerHTML=a;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=b;this.monitoring=!1;this.p={fps:40,dom:r,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,
FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(g,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function f(b){function r(c){a.p.mouseEnabled&&(g(a.mouseX,a.mouseY,a.ratio*(0<(void 0!=c.wheelDelta&&c.wheelDelta||
void 0!=c.detail&&-c.detail)?a.p.zoomMultiply:1/a.p.zoomMultiply)),a.p.blockScroll&&(c.preventDefault?c.preventDefault():c.returnValue=!1))}function g(b,d,g){if(!a.isMouseDown&&(window.clearInterval(a.interpolationID),z=void 0!=g,k=a.stageX,t=b,p=a.stageY,n=d,q=g||a.ratio,q=Math.min(Math.max(q,a.p.minRatio),a.p.maxRatio),w=a.p.directZooming?1-(z?a.p.zoomDelta:a.p.dragDelta):0,a.ratio!=q||a.stageX!=t||a.stageY!=n))c(),a.interpolationID=window.setInterval(c,50),a.dispatch("startinterpolate")}function c(){w+=
z?a.p.zoomDelta:a.p.dragDelta;w=Math.min(w,1);var c=sigma.easing.quadratic.easeout(w),b=a.ratio;a.ratio=b*(1-c)+q*c;z?(a.stageX=t+(a.stageX-t)*a.ratio/b,a.stageY=n+(a.stageY-n)*a.ratio/b):(a.stageX=k*(1-c)+t*c,a.stageY=p*(1-c)+n*c);a.dispatch("interpolate");1<=w&&(window.clearInterval(a.interpolationID),c=a.ratio,z?(a.ratio=q,a.stageX=t+(a.stageX-t)*a.ratio/c,a.stageY=n+(a.stageY-n)*a.ratio/c):(a.stageX=t,a.stageY=n),a.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);
var a=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var f=0,d=0,k=0,p=0,q=1,t=0,n=0,h=0,l=0,m=0,A=0,w=0,z=!1;this.stageY=this.stageX=0;this.ratio=1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;b.addEventListener("DOMMouseScroll",r,!0);b.addEventListener("mousewheel",r,!0);b.addEventListener("mousemove",function(c){a.mouseX=void 0!=c.offsetX&&c.offsetX||void 0!=c.layerX&&c.layerX||void 0!=c.clientX&&
c.clientX;a.mouseY=void 0!=c.offsetY&&c.offsetY||void 0!=c.layerY&&c.layerY||void 0!=c.clientY&&c.clientY;if(a.isMouseDown){var b=a.mouseX-f+k,g=a.mouseY-d+p;if(b!=a.stageX||g!=a.stageY)l=h,A=m,h=b,m=g,a.stageX=b,a.stageY=g,a.dispatch("drag")}a.dispatch("move");c.preventDefault?c.preventDefault():c.returnValue=!1},!0);b.addEventListener("mousedown",function(c){a.p.mouseEnabled&&(a.isMouseDown=!0,a.dispatch("mousedown"),k=a.stageX,p=a.stageY,f=a.mouseX,d=a.mouseY,l=h=a.stageX,A=m=a.stageY,a.dispatch("startdrag"),
c.preventDefault?c.preventDefault():c.returnValue=!1)},!0);document.addEventListener("mouseup",function(c){a.p.mouseEnabled&&a.isMouseDown&&(a.isMouseDown=!1,a.dispatch("mouseup"),(k!=a.stageX||p!=a.stageY)&&g(a.stageX+a.p.inertia*(a.stageX-l),a.stageY+a.p.inertia*(a.stageY-A)),c.preventDefault?c.preventDefault():c.returnValue=!1)},!0);this.checkBorders=function(c,b,d){return a};this.interpolate=g}function l(b,r,g,c,a,f,d){function k(a,c,b,d,g,h){a.fillStyle=c;a.beginPath();a.arc(b,d,g,0,2*Math.PI,
!0);a.closePath();a.fill()}function p(a){var b=c,d="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*a.displaySize;b.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+d+"px "+(h.p.hoverFont||h.p.font||"");b.fillStyle="node"==h.p.labelHoverBGColor?a.color||h.p.defaultNodeColor:h.p.defaultHoverLabelBGColor;b.beginPath();h.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=h.p.labelHoverShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-
2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;var g="node"==h.p.nodeBorderColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;h.drawHoverNodeBorder(b,g,Math.round(a.displayX),Math.round(a.displayY),a.displaySize+h.p.borderSize,a);g="node"==h.p.nodeHoverColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeHoverColor;h.drawHoverNodeShape(b,
g,Math.round(a.displayX),Math.round(a.displayY),a.displaySize,a);b.fillStyle="node"==h.p.labelHoverColor?a.color||h.p.defaultNodeColor:h.p.defaultLabelHoverColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return h}function q(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-l/3&&a.displayX-a.displaySize<4*l/3&&a.displayY+a.displaySize>-m/3&&a.displayY-a.displaySize<
4*m/3}function t(a,c){return c==a||"both"==c||!c&&(h.p.defaultEdgeArrow==a||"both"==h.p.defaultEdgeArrow)}function n(a,c,b,d,g,h){var r=c[0]-d,f=c[1]-g;b/=Math.sqrt(r*r+f*f);c[0]-=r*b;c[1]-=f*b;a.lineWidth=0;a.fillStyle=a.strokeStyle;sigma.tools.drawArrowhead(a,c[0],c[1],h,sigma.tools.getIncidenceAngle(d,g,c[0],c[1]));return c}sigma.classes.Cascade.call(this);var h=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,
labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultEdgeArrow:"none",
defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var l=f,m=d;this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.drawActiveNodeShape=this.drawActiveNodeBorder=this.drawHoverNodeShape=this.drawHoverNodeBorder=this.drawNodeShape=k;this.task_drawLabel=function(){for(var c=a.nodes.length,b=
0;b++<h.p.labelsSpeed&&h.currentLabelIndex<c;)if(h.isOnScreen(a.nodes[h.currentLabelIndex])){var d=a.nodes[h.currentLabelIndex++],r=g;if(d.displaySize>=h.p.labelThreshold||d.forceLabel){var f="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*d.displaySize;r.font=h.p.fontStyle+f+"px "+h.p.font;r.fillStyle="node"==h.p.labelColor?d.color||h.p.defaultNodeColor:h.p.defaultLabelColor;r.fillText(d.label,Math.round(d.displayX+1.5*d.displaySize),Math.round(d.displayY+f/2-3))}}else h.currentLabelIndex++;
return h.currentLabelIndex<c};this.task_drawEdge=function(){for(var c=a.edges.length,b,d,g=0;g++<h.p.edgesSpeed&&h.currentEdgeIndex<c;)if(e=a.edges[h.currentEdgeIndex],b=e.source,d=e.target,e.hidden||b.hidden||d.hidden||!h.isOnScreen(b)&&!h.isOnScreen(d))h.currentEdgeIndex++;else{b=a.edges[h.currentEdgeIndex++];d=[b.source.displayX,b.source.displayY];var f=[b.target.displayX,b.target.displayY],p=b.color;if(!p)switch(h.p.edgeColor){case "source":p=b.source.color||h.p.defaultNodeColor;break;case "target":p=
b.target.color||h.p.defaultNodeColor;break;default:p=h.p.defaultEdgeColor}var k=r;switch(b.type||h.p.defaultEdgeType){case "curve":k.strokeStyle=p;var p=(d[0]+f[0])/2+(f[1]-d[1])/4,q=(d[1]+f[1])/2+(d[0]-f[0])/4;t("source",b.arrow)&&(d=n(k,d,b.source.displaySize,p,q,b.arrowDisplaySize));t("target",b.arrow)&&(f=n(k,f,b.target.displaySize,p,q,b.arrowDisplaySize));k.lineWidth=b.displaySize/3;k.beginPath();k.moveTo(d[0],d[1]);k.quadraticCurveTo(p,q,f[0],f[1]);k.stroke();break;default:k.strokeStyle=p,t("source",
b.arrow)&&(d=n(k,d,b.source.displaySize,f[0],f[1],b.arrowDisplaySize)),t("target",b.arrow)&&(f=n(k,f,b.target.displaySize,d[0],d[1],b.arrowDisplaySize)),k.lineWidth=b.displaySize/3,k.beginPath(),k.moveTo(d[0],d[1]),k.lineTo(f[0],f[1]),k.stroke()}}return h.currentEdgeIndex<c};this.task_drawNode=function(){for(var c=a.nodes.length,d=0;d++<h.p.nodesSpeed&&h.currentNodeIndex<c;)if(h.isOnScreen(a.nodes[h.currentNodeIndex])){var g=a.nodes[h.currentNodeIndex++],f=Math.round(10*g.displaySize)/10;h.drawNodeShape(b,
g.color,g.displayX,g.displayY,f,g);g.hover&&p(g)}else h.currentNodeIndex++;return h.currentNodeIndex<c};this.drawActiveNode=function(a){var b=c;if(!q(a))return h;var d="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*a.displaySize;b.font=(h.p.activeFontStyle||h.p.fontStyle||"")+" "+d+"px "+(h.p.activeFont||h.p.font||"");b.fillStyle="node"==h.p.labelHoverBGColor?a.color||h.p.defaultNodeColor:h.p.defaultActiveLabelBGColor;b.beginPath();h.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=
0,b.shadowBlur=4,b.shadowColor=h.p.labelActiveShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-d/2-2),Math.round(a.displayY-d/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+d/2+4),Math.round(d+4),Math.round(d/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;var g="node"==h.p.nodeBorderColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;h.drawActiveNodeBorder(b,g,Math.round(a.displayX),Math.round(a.displayY),a.displaySize+
h.p.borderSize,a);g="node"==h.p.nodeActiveColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeActiveColor;h.drawActiveNodeShape(b,g,Math.round(a.displayX),Math.round(a.displayY),a.displaySize,a);b.fillStyle="node"==h.p.labelActiveColor?a.color||h.p.defaultNodeColor:h.p.defaultLabelActiveColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+d/2-3));return h};this.drawHoverNode=p;this.isOnScreen=q;this.resize=function(a,b){l=a;m=b;return h}}function m(b,r){function g(){sigma.chronos.removeTask("node_"+
d.id,2).removeTask("edge_"+d.id,2).removeTask("label_"+d.id,2).stopTasks();return d}function c(a,b){d.domElements[a]=document.createElement(b);d.domElements[a].style.position="absolute";d.domElements[a].setAttribute("id","sigma_"+a+"_"+d.id);d.domElements[a].setAttribute("class","sigma_"+a+"_"+b);d.domElements[a].setAttribute("width",d.width+"px");d.domElements[a].setAttribute("height",d.height+"px");d.domRoot.appendChild(d.domElements[a]);return d}function a(){d.p.drawHoverNodes&&(d.graph.checkHover(d.mousecaptor.mouseX,
d.mousecaptor.mouseY),d.graph.nodes.forEach(function(a){a.hover&&!a.active&&d.plotter.drawHoverNode(a)}));return d}function E(){d.p.drawActiveNodes&&d.graph.nodes.forEach(function(a){a.active&&d.plotter.drawActiveNode(a)});return d}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var d=this;this.id=r.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:!0,drawActiveNodes:!0};this.domRoot=b;this.width=this.domRoot.offsetWidth;
this.height=this.domRoot.offsetHeight;this.graph=new k;this.domElements={};c("edges","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new l(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new s(this,this.domElements.monitor);this.mousecaptor=new f(this.domElements.mouse,
this.id);this.mousecaptor.bind("drag interpolate",function(a){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("stopdrag stopinterpolate",function(a){d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?1:d.p.drawEdges,d.p.auto?2:d.p.drawLabels,!0)}).bind("mousedown mouseup",function(a){var b=d.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});d.dispatch("mousedown"==a.type?"downgraph":"upgraph");b.length&&d.dispatch("mousedown"==a.type?
"downnodes":"upnodes",b)}).bind("move",function(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);a();E()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",""))})&&d.draw(d.p.auto?2:d.p.drawNodes,d.p.auto?0:d.p.drawEdges,d.p.auto?2:d.p.drawLabels)}).bind("stopgenerators",function(){d.draw()});for(var m=0;m<G.plugins.length;m++)G.plugins[m](this);this.draw=
function(a,b,c,f){if(f&&sigma.chronos.getGeneratorsIDs().some(function(a){return!!a.match(RegExp("_ext_"+d.id+"$",""))}))return d;a=void 0==a?d.p.drawNodes:a;b=void 0==b?d.p.drawEdges:b;c=void 0==c?d.p.drawLabels:c;f={nodes:a,edges:b,labels:c};d.p.lastNodes=a;d.p.lastEdges=b;d.p.lastLabels=c;g();d.graph.rescale(d.width,d.height,0<a,0<b).setBorders();d.mousecaptor.checkBorders(d.graph.borders,d.width,d.height);d.graph.translate(d.mousecaptor.stageX,d.mousecaptor.stageY,d.mousecaptor.ratio,0<a,0<b);
d.dispatch("graphscaled");for(var h in d.domElements)"canvas"==d.domElements[h].nodeName.toLowerCase()&&(void 0==f[h]||0<=f[h])&&d.domElements[h].getContext("2d").clearRect(0,0,d.domElements[h].width,d.domElements[h].height);d.plotter.currentEdgeIndex=0;d.plotter.currentNodeIndex=0;d.plotter.currentLabelIndex=0;h=null;f=!1;if(a)if(1<a)for(;d.plotter.task_drawNode(););else sigma.chronos.addTask(d.plotter.task_drawNode,"node_"+d.id,!1),f=!0,h="node_"+d.id;if(c)if(1<c)for(;d.plotter.task_drawLabel(););
else h?sigma.chronos.queueTask(d.plotter.task_drawLabel,"label_"+d.id,h):sigma.chronos.addTask(d.plotter.task_drawLabel,"label_"+d.id,!1),f=!0,h="label_"+d.id;if(b)if(1<b)for(;d.plotter.task_drawEdge(););else h?sigma.chronos.queueTask(d.plotter.task_drawEdge,"edge_"+d.id,h):sigma.chronos.addTask(d.plotter.task_drawEdge,"edge_"+d.id,!1),f=!0,h="edge_"+d.id;d.dispatch("draw");d.refresh();f&&sigma.chronos.runTasks();return d};this.resize=function(a,b){var c=d.width,g=d.height;void 0!=a&&void 0!=b?(d.width=
a,d.height=b):(d.width=d.domRoot.offsetWidth,d.height=d.domRoot.offsetHeight);if(c!=d.width||g!=d.height){for(var h in d.domElements)d.domElements[h].setAttribute("width",d.width+"px"),d.domElements[h].setAttribute("height",d.height+"px");d.plotter.resize(d.width,d.height);d.draw(d.p.lastNodes,d.p.lastEdges,d.p.lastLabels,!0)}return d};this.refresh=function(){d.domElements.hover.getContext("2d").clearRect(0,0,d.domElements.hover.width,d.domElements.hover.height);a();E();return d};this.drawHover=a;
this.drawActive=E;this.clearSchedule=g;window.addEventListener("resize",function(){d.resize()})}function y(b){var f=this;sigma.classes.EventDispatcher.call(this);this._core=b;this.kill=function(){};this.getID=function(){return b.id};this.configProperties=function(g,c){var a=b.config(g,c);return a==b?f:a};this.drawingProperties=function(g,c){var a=b.plotter.config(g,c);return a==b.plotter?f:a};this.mouseProperties=function(g,c){var a=b.mousecaptor.config(g,c);return a==b.mousecaptor?f:a};this.graphProperties=
function(g,c){var a=b.graph.config(g,c);return a==b.graph?f:a};this.getMouse=function(){return{mouseX:b.mousecaptor.mouseX,mouseY:b.mousecaptor.mouseY,down:b.mousecaptor.isMouseDown}};this.position=function(g,c,a){if(0==arguments.length)return{stageX:b.mousecaptor.stageX,stageY:b.mousecaptor.stageY,ratio:b.mousecaptor.ratio};b.mousecaptor.stageX=void 0!=g?g:b.mousecaptor.stageX;b.mousecaptor.stageY=void 0!=c?c:b.mousecaptor.stageY;b.mousecaptor.ratio=void 0!=a?a:b.mousecaptor.ratio;return f};this.goTo=
function(g,c,a){b.mousecaptor.interpolate(g,c,a);return f};this.zoomTo=function(g,c,a){a=Math.min(Math.max(b.mousecaptor.config("minRatio"),a),b.mousecaptor.config("maxRatio"));a==b.mousecaptor.ratio?b.mousecaptor.interpolate(g-b.width/2+b.mousecaptor.stageX,c-b.height/2+b.mousecaptor.stageY):b.mousecaptor.interpolate((a*g-b.mousecaptor.ratio*b.width/2)/(a-b.mousecaptor.ratio),(a*c-b.mousecaptor.ratio*b.height/2)/(a-b.mousecaptor.ratio),a);return f};this.resize=function(g,c){b.resize(g,c);return f};
this.draw=function(g,c,a,k){b.draw(g,c,a,k);return f};this.refresh=function(){b.refresh();return f};this.addGenerator=function(g,c,a){sigma.chronos.addGenerator(g+"_ext_"+b.id,c,a);return f};this.removeGenerator=function(g){sigma.chronos.removeGenerator(g+"_ext_"+b.id);return f};this.addNode=function(g,c){b.graph.addNode(g,c);return f};this.addEdge=function(g,c,a,k){b.graph.addEdge(g,c,a,k);return f};this.dropNode=function(g){b.graph.dropNode(g);return f};this.dropEdge=function(g){b.graph.dropEdge(g);
return f};this.pushGraph=function(g,c){g.nodes&&g.nodes.forEach(function(a){a.id&&(!c||!b.graph.nodesIndex[a.id])&&f.addNode(a.id,a)});g.edges&&g.edges.forEach(function(a){(validID=a.source&&a.target&&a.id)&&(!c||!b.graph.edgesIndex[a.id])&&f.addEdge(a.id,a.source,a.target,a)});return f};this.emptyGraph=function(){b.graph.empty();return f};this.getNodesCount=function(){return b.graph.nodes.length};this.getEdgesCount=function(){return b.graph.edges.length};this.iterNodes=function(g,c){b.graph.iterNodes(g,
c);return f};this.iterEdges=function(g,c){b.graph.iterEdges(g,c);return f};this.getNodes=function(g){return b.graph.getNodes(g)};this.getEdges=function(g){return b.graph.getEdges(g)};this.activateMonitoring=function(){return b.monitor.activate()};this.desactivateMonitoring=function(){return b.monitor.desactivate()};b.bind("downnodes upnodes downgraph upgraph",function(b){f.dispatch(b.type,b.content)});b.graph.bind("overnodes outnodes",function(b){f.dispatch(b.type,b.content)})}var v=0,G={plugins:[]};
sigma.init=function(b){b=new m(b,(++v).toString());sigma.instances[v]=new y(b);return sigma.instances[v]};sigma.addPlugin=function(b,f,g){y.prototype[b]=f;G.plugins.push(g)};sigma.chronos=new function(){function b(a){window.setTimeout(a,0);return q}function f(){for(q.dispatch("frameinserted");m&&x.length&&g(););!m||!x.length?a():(y=(new Date).getTime(),s++,D=w-v,A=v-D,q.dispatch("insertframe"),b(f))}function g(){C%=x.length;if(!x[C].task()){var a=x[C].taskName;B=B.filter(function(b){b.taskParent==
a&&x.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});q.dispatch("killed",x.splice(C--,1)[0])}C++;w=(new Date).getTime()-y;return w<=A}function c(){m=!0;s=C=0;z=y=(new Date).getTime();q.dispatch("start");q.dispatch("insertframe");b(f);return q}function a(){q.dispatch("stop");m=!1;return q}function k(a,b,d){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');x.push({taskName:b,task:a});m=!(!m&&!(d&&c()||1));return q}function d(a){return a?Object.keys(u).filter(function(a){return!!u[a].on}).length:
Object.keys(u).length}function l(){Object.keys(u).length?(q.dispatch("startgenerators"),q.unbind("killed",p),b(function(){for(var a in u)u[a].on=!0,k(u[a].task,a,!1)}),q.bind("killed",p).runTasks()):q.dispatch("stopgenerators");return q}function p(a){void 0!=u[a.content.taskName]&&(u[a.content.taskName].del||!u[a.content.taskName].condition()?delete u[a.content.taskName]:u[a.content.taskName].on=!1,0==d(!0)&&l())}sigma.classes.EventDispatcher.call(this);var q=this,m=!1,n=80,h=0,s=0,v=1E3/n,A=v,w=
0,z=0,y=0,D=0,u={},x=[],B=[],C=0;this.frequency=function(a){return void 0!=a?(n=Math.abs(1*a),v=1E3/n,s=0,q):n};this.runTasks=c;this.stopTasks=a;this.insertFrame=b;this.addTask=k;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!x.concat(B).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');B.push({taskParent:c,taskName:b,task:a});return q};this.removeTask=function(b,c){if(void 0==b)x=[],1==
c?B=[]:2==c&&(x=B,B=[]),a();else{var d="string"==typeof b?b:"";x=x.filter(function(a){return("string"==typeof b?a.taskName==b:a.task==b)?(d=a.taskName,!1):!0});0<c&&(B=B.filter(function(a){1==c&&a.taskParent==d&&x.push(a);return a.taskParent!=d}))}m=!(x.length&&(!a()||1));return q};this.addGenerator=function(a,b,c){if(void 0!=u[a])return q;u[a]={task:b,condition:c};0==d(!0)&&l();return q};this.removeGenerator=function(a){u[a]&&(u[a].on=!1,u[a].del=!0);return q};this.startGenerators=l;this.getGeneratorsIDs=
function(){return Object.keys(u)};this.getFPS=function(){m&&(h=Math.round(1E4*(s/((new Date).getTime()-z)))/10);return h};this.getTasksCount=function(){return x.length};this.getQueuedTasksCount=function(){return B.length};this.getExecutionTime=function(){return y-z};return this};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var b in arguments)console.log(arguments[b]);else if(1<sigma.debugMode)for(b in arguments)throw Error(arguments[b]);return sigma};sigma.easing={linear:{},quadratic:{}};
sigma.easing.linear.easenone=function(b){return b};sigma.easing.quadratic.easein=function(b){return b*b};sigma.easing.quadratic.easeout=function(b){return-b*(b-2)};sigma.easing.quadratic.easeinout=function(b){return 1>(b*=2)?0.5*b*b:-0.5*(--b*(b-2)-1)};sigma.tools.drawRoundRect=function(b,f,g,c,a,k,d){k=k?k:0;var l=d?d:[],l="string"==typeof l?l.split(" "):l;d=k&&(0<=l.indexOf("topleft")||0<=l.indexOf("top")||0<=l.indexOf("left"));var m=k&&(0<=l.indexOf("topright")||0<=l.indexOf("top")||0<=l.indexOf("right")),
q=k&&(0<=l.indexOf("bottomleft")||0<=l.indexOf("bottom")||0<=l.indexOf("left")),l=k&&(0<=l.indexOf("bottomright")||0<=l.indexOf("bottom")||0<=l.indexOf("right"));b.moveTo(f,g+k);d?b.arcTo(f,g,f+k,g,k):b.lineTo(f,g);m?(b.lineTo(f+c-k,g),b.arcTo(f+c,g,f+c,g+k,k)):b.lineTo(f+c,g);l?(b.lineTo(f+c,g+a-k),b.arcTo(f+c,g+a,f+c-k,g+a,k)):b.lineTo(f+c,g+a);q?(b.lineTo(f+k,g+a),b.arcTo(f,g+a,f,g+a-k,k)):b.lineTo(f,g+a);b.lineTo(f,g+k)};sigma.tools.drawArrowhead=function(b,f,g,c,a){b.beginPath();b.moveTo(f,g);
var k=f+Math.cos(0.017453292519943295*(22+a))*c,d=g+Math.sin(0.017453292519943295*(22+a))*c,l=f+Math.cos(0.017453292519943295*(a-22))*c;c=g+Math.sin(0.017453292519943295*(a-22))*c;b.lineTo(k,d);b.quadraticCurveTo((f+k+l)/3,(g+d+c)/3,l,c);b.lineTo(f,g);b.fill()};sigma.tools.getRGB=function(b,f){b=b.toString();var g={r:0,g:0,b:0};if(3<=b.length&&"#"==b.charAt(0)){var c=b.length-1;6==c?g={r:parseInt(b.charAt(1)+b.charAt(2),16),g:parseInt(b.charAt(3)+b.charAt(4),16),b:parseInt(b.charAt(5)+b.charAt(5),
16)}:3==c&&(g={r:parseInt(b.charAt(1)+b.charAt(1),16),g:parseInt(b.charAt(2)+b.charAt(2),16),b:parseInt(b.charAt(3)+b.charAt(3),16)})}f&&(g=[g.r,g.g,g.b]);return g};sigma.tools.rgbToHex=function(b,f,g){return sigma.tools.toHex(b)+sigma.tools.toHex(f)+sigma.tools.toHex(g)};sigma.tools.toHex=function(b){b=parseInt(b,10);if(isNaN(b))return"00";b=Math.max(0,Math.min(b,255));return"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16)};sigma.tools.getIncidenceAngle=function(b,f,g,c){return(b<=
g?180:0)+180*Math.atan((c-f)/(g-b))/Math.PI};sigma.publicPrototype=y.prototype})();